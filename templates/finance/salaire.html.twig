{% extends "admin.html.twig" %}
{% block title %} {{ "Liste des bulletins"|trans }} - GNT Pharma {% endblock %}
{% block paie %}active{% endblock %}
{% block paie_historique %}active{% endblock %}

{% block body %}
<div class="col-lg-10 mt-4 fond-7">
    <h3 class="mt-4 mb-5 text-bold">
        <i class="fa fa-money-bill mr-2"></i>
        {{ "En attente de paiement"|trans }}
    </h3>
    {% for message in app.flashes('notice') %}
        <div class="alert alert-success alert-dismissible fade show radius-10 shadow-black">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                &times;
            </button>
            {{ message|trans }}
        </div>
    {% endfor %}
    <div id="flash"></div>

    <table class="table table-success-light table-bordered table-hover table-striped w-100" id="liste">
        <thead>
        <tr>
            <th>{{ 'Matricule'|trans }}</th>
            <th>{{ 'Employé'|trans }}</th>
            <th>{{ 'Date de validation'|trans }}</th>
            <th>{{ 'Salaire de base'|trans }}</th>
            <th>{{ 'Montant reçu'|trans }}</th>
            <th>{{ 'Action'|trans }}</th>
        </tr>
        </thead>
        <tbody>
        {% set montant = 0 %}
        {% for paie in paie %}
            <tr id="tr{{ paie.id }}">
                <td>{{ paie.employe.matricule }}</td>
                <td>{{ paie.employe.nom }} {{ paie.employe.prenom }}</td>
                <td>{{ paie.date|date('d/m/Y') }}</td>
                <td>{{ paie.salaireBase|number_format(0, '' , ' ') }} FCFA</td>
                <td>{{ paie.salaireNet|number_format(0, '' , ' ') }} FCFA</td>
                <td><button id="btn{{ paie.id }}" onclick="payerOne({{ paie.id }})" class="btn btn-success">Payer</button></td>
                {% set montant = montant + paie.salaireNet %}
            </tr>
        {% else %}
            <tr>
                <td colspan="6" class="text-center">Aucune paiement enregistrée</td>
            </tr>
        {% endfor %}
        <tr>
            <th colspan="6" class="text-center">{{ 'Montant total'|trans }} : {{ montant|number_format(0, '' , ' ') }}
                FCFA
                <button id="tous" onclick="payerTous()" class="btn btn-success"> Payer Tous</button>
            </th>
        </tr>
        </tbody>
    </table>
</div>
    {% block scripts %}
    <script>
        function payerOne(id) {
            if(confirm("{{ 'Voulez-vous vraiement effetuer le paiement' }}")){
                $("#btn"+id).html("<i class='fa-solid fa-spinner fa-spin-pulse fa-lg'></i>");
                $.ajax({
                    type: "POST",
                    url: "{{ path('finance_payer') }}",
                    data: "paie=" + id ,
                    success: function (data) {
                        if (data['id'] == 'ok') {
                            document.location.href="{{ path('finance_salaire') }}";

                        }
                    },
                    error: function () {
                        alert('{{ "La requête n'a pas abouti"|trans }}');
                    }
                });
            }

        }
        function payerTous() {
            if(confirm("{{ 'Voulez-vous vraiement payer tous' }}")){
                $("#tous").html("<i class='fa-solid fa-spinner fa-spin-pulse fa-lg'></i>");
                $.ajax({
                    type: "POST",
                    url: "{{ path('finance_payer') }}",
                    success: function (data) {
                        if (data['id'] == 'ok') {
                            document.location.href="{{ path('finance_salaire') }}";

                        }
                    },
                    error: function () {
                        alert('{{ "La requête n'a pas abouti"|trans }}');
                    }
                });
            }

        }
    </script>
    {% endblock %}
{% endblock %}
